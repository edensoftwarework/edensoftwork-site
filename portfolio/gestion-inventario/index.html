<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Gestión de Inventario - EDEN SoftWork</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../../styles.css">
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/exceljs/4.3.0/exceljs.min.js"></script>
</head>
<body>
  <div class="container">
    <img src="logo_4.png" class="small-logo" alt="EDEN SoftWork Logo">
    <h1>Sistema de Gestión de Inventario</h1>
    <p>Sistema profesional para agregar, visualizar y gestionar productos en inventario. Adaptable a cualquier organización que maneje stock y control de productos.</p>

    <!-- Sección de Gestión -->
    <div class="management-section">
      <h3>Herramientas de Gestión</h3>
      <div class="management-buttons">
        <button id="add-product-btn">Agregar Producto</button>
        <button id="add-category-btn">Agregar Categoría</button>
        <button id="add-supplier-btn">Agregar Proveedor</button>
        <button id="add-movement-btn">Registrar Movimiento</button>
        <button id="export-btn">Exportar a Excel</button>
      </div>
    </div>

    <!-- Sección de Inventario -->
    <div class="inventory-section">
      <h3>Inventario de Productos</h3>

      <!-- Filtros y Búsqueda -->
      <div class="filters">
        <input type="text" id="search" placeholder="Buscar por nombre">
        <select id="filter-category">
          <option value="">Todas las Categorías</option>
        </select>
        <select id="filter-supplier">
          <option value="">Todos los Proveedores</option>
        </select>
        <select id="filter-stock">
          <option value="">Todos los Niveles</option>
          <option value="low">Bajo Stock</option>
          <option value="normal">Normal</option>
          <option value="high">Alto Stock</option>
        </select>
        <input type="number" id="filter-min-price" placeholder="Precio Mín">
        <input type="number" id="filter-max-price" placeholder="Precio Máx">
        <button id="clear-filters">Limpiar Filtros</button>
      </div>

      <hr style="border: none; height: 2px; background: #ccc; margin: 30px 0;">

      <!-- Tabla de Inventario -->
      <div class="inventory-table">
        <table id="products-table">
          <thead>
            <tr>
              <th>Nombre</th>
              <th>Categoría</th>
              <th>Proveedor</th>
              <th>Stock</th>
              <th>Precio Venta</th>
              <th>Valor Total</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="products-tbody">
            <!-- Productos se agregarán aquí -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Sección de Estadísticas -->
    <div class="stats-section">
      <h3>Estadísticas y Gráficos</h3>

      <!-- Estadísticas Detalladas -->
      <div style="text-align: center; margin: 20px 0;">
        <button id="toggle-detailed-stats" style="padding: 10px 20px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px;">Ver Todas las Estadísticas</button>
      </div>
      <div id="detailed-stats-container" style="display: block; margin-top: 20px; margin-bottom: 40px;">
        <div class="detailed-stats">
          <div class="stat-group">
            <h4>Total de Productos</h4>
            <p id="stats-total">0</p>
          </div>
          <div class="stat-group">
            <h4>Valor Total del Inventario</h4>
            <p id="stats-value">$0</p>
          </div>
          <div class="stat-group">
            <h4>Productos con Bajo Stock</h4>
            <p id="stats-low-stock">0</p>
          </div>
          <div class="stat-group">
            <h4>Producto con Mayor Valor</h4>
            <p id="stats-top-value-product">Cargando...</p>
          </div>
          <div class="stat-group">
            <h4>Categoría con Mayor Valor</h4>
            <p id="stats-top-value-category">Cargando...</p>
          </div>
          <div class="stat-group">
            <h4>Promedio Precio por Categoría</h4>
            <p id="stats-avg-price-category">Cargando...</p>
          </div>
          <div class="stat-group">
            <h4>Valor Movimientos Último Mes</h4>
            <p id="stats-monthly-movements">Cargando...</p>
          </div>
          <div class="stat-group">
            <h4>Productos sin Stock</h4>
            <p id="stats-critical-stock">Cargando...</p>
          </div>
          <div class="stat-group">
            <h4>Proveedor con Más Productos</h4>
            <p id="stats-top-supplier">Cargando...</p>
          </div>
        </div>
      </div>

      <hr style="border: none; height: 2px; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); margin: 40px 0;">

      <!-- Gráficos -->
      <div class="chart-sections">
        <div class="chart-section">
          <button id="toggle-category-chart">Ver Gráfico de Categorías</button>
          <div id="category-chart-container" style="display: block; margin: 10px auto;">
            <canvas id="categoryChart" width="400" height="400"></canvas>
          </div>
        </div>
        <div class="chart-section">
          <button id="toggle-stock-chart">Ver Gráfico de Niveles de Stock</button>
          <div id="stock-chart-container" style="display: block; margin: 10px auto;">
            <canvas id="stockChart" width="400" height="400"></canvas>
          </div>
        </div>
        <div class="chart-section">
          <button id="toggle-value-chart">Ver Gráfico de Valor por Producto</button>
          <div id="value-chart-container" style="display: block; margin: 10px auto;">
            <canvas id="valueChart" width="400" height="400"></canvas>
          </div>
        </div>
        <div class="chart-section">
          <button id="toggle-demand-chart">Ver Gráfico de Demanda Temporal</button>
          <div id="demand-chart-container" style="display: block; margin: 10px auto;">
            <div class="demand-controls" style="margin-bottom: 15px; text-align: center;">
              <label style="font-weight: 600; margin-right: 10px;">Producto:</label>
              <select id="demand-product-filter" style="padding: 8px; border-radius: 5px; border: 1px solid #ddd; margin-right: 20px;">
                <option value="">Seleccionar producto</option>
              </select>
              <label style="font-weight: 600; margin-right: 10px;">Período:</label>
              <button class="time-range-btn active" data-months="6">6 Meses</button>
              <button class="time-range-btn" data-months="12">12 Meses</button>
              <button class="time-range-btn" data-months="18">18 Meses</button>
              <button class="time-range-btn" data-months="24">24 Meses</button>
            </div>
            <canvas id="demandChart" width="900" height="450"></canvas>
          </div>
        </div>
      </div>
    </div>

    <!-- Modales -->
    <div id="edit-modal" class="modal">
      <div class="modal-content">
        <span class="close" id="edit-close">&times;</span>
        <h3>Editar Producto</h3>
        <form id="edit-form">
          <input type="text" id="edit-name" placeholder="Nombre" required>
          <input type="text" id="edit-description" placeholder="Descripción">
          <select id="edit-category" required></select>
          <select id="edit-supplier" required></select>
          <input type="number" id="edit-purchase-price" step="0.01" min="0" required>
          <input type="number" id="edit-sale-price" step="0.01" min="0" required>
          <input type="number" id="edit-stock" min="0" required>
          <input type="text" id="edit-unit" required>
          <input type="number" id="edit-threshold" min="0">
          <button type="submit">Actualizar Producto</button>
          <button type="button" id="cancel-edit">Cancelar</button>
        </form>
      </div>
    </div>

    <div id="category-modal" class="modal">
      <div class="modal-content">
        <span class="close" id="category-close">&times;</span>
        <h3>Agregar Categoría</h3>
        <form id="category-form" style="display: flex; flex-direction: column;">
          <input type="text" id="category-name" placeholder="Nombre de Categoría" required>
          <button type="submit" style="align-self: center; margin-top: 20px;">Agregar</button>
        </form>
      </div>
    </div>

    <div id="supplier-modal" class="modal">
      <div class="modal-content">
        <span class="close" id="supplier-close">&times;</span>
        <h3>Agregar Proveedor</h3>
        <form id="supplier-form" style="display: flex; flex-direction: column;">
          <input type="text" id="supplier-name" placeholder="Nombre del Proveedor" required>
          <input type="text" id="supplier-contact" placeholder="Contacto">
          <button type="submit" style="align-self: center; margin-top: 20px;">Agregar</button>
        </form>
      </div>
    </div>

    <div id="movement-modal" class="modal">
      <div class="modal-content">
        <span class="close" id="movement-close">&times;</span>
        <h3>Registrar Movimiento</h3>
        <form id="movement-form">
          <select id="movement-product" required>
            <option value="">Seleccionar Producto</option>
          </select>
          <select id="movement-type" required>
            <option value="entrada">Entrada (Compra)</option>
            <option value="salida">Salida (Venta)</option>
            <option value="ajuste">Ajuste</option>
          </select>
          <input type="number" id="movement-quantity" placeholder="Cantidad" min="1" required>
          <input type="date" id="movement-date" required>
          <textarea id="movement-notes" placeholder="Notas"></textarea>
          <div style="display: flex; justify-content: center; margin-top: 10px;">
            <button type="submit">Registrar</button>
          </div>
        </form>
      </div>
    </div>

    <div id="message-modal" class="message-modal">
      <div class="message-content">
        <span class="message-close">&times;</span>
        <p id="message-text"></p>
      </div>
    </div>

    <div id="category-products-modal" class="modal">
      <div class="modal-content">
        <span class="close" id="category-products-close">&times;</span>
        <div id="category-products-text"></div>
      </div>
    </div>

    <div id="product-modal" class="modal">
      <div class="modal-content">
        <span class="close" id="product-close">&times;</span>
        <h3>Agregar Producto</h3>
        <form id="product-form">
          <input type="text" id="product-name" placeholder="Nombre del Producto" required>
          <input type="text" id="product-description" placeholder="Descripción">
          <select id="product-category" required>
            <option value="">Seleccionar Categoría</option>
          </select>
          <select id="product-supplier" required>
            <option value="">Seleccionar Proveedor</option>
          </select>
          <input type="number" id="purchase-price" placeholder="Precio de Compra" step="0.01" min="0" required>
          <input type="number" id="sale-price" placeholder="Precio de Venta" step="0.01" min="0" required>
          <input type="number" id="initial-stock" placeholder="Stock Inicial" min="0" required>
          <input type="text" id="unit" placeholder="Unidad (ej. unidades, kg)" required>
          <input type="number" id="low-stock-threshold" placeholder="Alerta de stock bajo (ej: 5 kg)" min="0">
          <div style="display: flex; justify-content: center; gap: 10px;">
            <button type="submit" id="submit-product-btn">Agregar Producto</button>
            <button type="button" id="cancel-product">Cancelar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Sección de Historial de Movimientos -->
    <div class="movements-section">
      <h3>Historial de Movimientos</h3>
      <button id="toggle-movements">Ocultar Historial de Movimientos</button>
      <div id="movements-container" style="display: block; margin-top: 20px;">
        <!-- Filtros para movimientos -->
        <div class="filters" style="margin-bottom: 20px; display: flex; gap: 25px; flex-wrap: wrap; align-items: center; justify-content: center;">
          <div style="display: flex; flex-direction: column; align-items: center;">
            <label for="filter-movement-product" style="font-size: 12px; margin-bottom: 5px;">Producto</label>
            <select id="filter-movement-product">
              <option value="">Todos los Productos</option>
            </select>
          </div>
          <div style="display: flex; flex-direction: column; align-items: center;">
            <label for="filter-movement-type" style="font-size: 12px; margin-bottom: 5px;">Movimiento</label>
            <select id="filter-movement-type">
              <option value="">Todos los Tipos</option>
              <option value="entrada">Entrada</option>
              <option value="salida">Salida</option>
              <option value="ajuste">Ajuste</option>
            </select>
          </div>
          <div style="display: flex; flex-direction: column; align-items: center;">
            <label for="filter-movement-from" style="font-size: 12px; margin-bottom: 5px;">Fecha Desde</label>
            <input type="date" id="filter-movement-from">
          </div>
          <div style="display: flex; flex-direction: column; align-items: center;">
            <label for="filter-movement-to" style="font-size: 12px; margin-bottom: 5px;">Fecha Hasta</label>
            <input type="date" id="filter-movement-to">
          </div>
          <div style="display: flex; align-items: flex-end;">
            <button id="clear-movement-filters" style="padding: 8px 12px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">Limpiar Filtros</button>
          </div>
        </div>
        <div class="inventory-table">
          <table id="movements-table">
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Producto</th>
                <th>Tipo</th>
                <th>Cantidad</th>
                <th>Notas</th>
              </tr>
            </thead>
            <tbody id="movements-tbody">
              <!-- Movimientos se agregarán aquí -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <p style="text-align: center; margin-top: 30px;"><a href="../../index.html" style="color: #667eea; text-decoration: none; font-size: 16px;">← Volver a inicio</a></p>
  </div>

  <!-- Modal de Tutorial -->
  <div id="tutorial-modal" class="modal" style="display: block;">
    <div class="modal-content tutorial-modal">
      <span id="tutorial-close" class="close">&times;</span>
      <h2>Bienvenido al Sistema de Gestión de Inventario</h2>
      <div class="tutorial-intro">
        <p><strong>Este demo está basado en un restaurante,</strong> pero el sistema se puede adaptar fácilmente a cualquier tipo de emprendimiento o negocio que maneje inventarios.</p>
      </div>
      <div class="tutorial-slider-container">
        <button class="slider-arrow slider-arrow-left" id="prev-step">‹</button>
        <div class="tutorial-steps">
          <div class="step active">
            <div class="step-number">1</div>
            <div class="step-content">
              <h3>Agregar Productos</h3>
              <p>Registra nuevos productos en el inventario especificando nombre, categoría, proveedor, precio y stock inicial.</p>
            </div>
          </div>
          <div class="step">
            <div class="step-number">2</div>
            <div class="step-content">
              <h3>Gestionar Categorías y Proveedores</h3>
              <p>Crea categorías para organizar productos y registra proveedores para rastrear el origen de los items.</p>
            </div>
          </div>
          <div class="step">
            <div class="step-number">3</div>
            <div class="step-content">
              <h3>Registrar Movimientos</h3>
              <p>Registra entradas (compras) y salidas (ventas/consumo) para mantener el stock actualizado.</p>
            </div>
          </div>
          <div class="step">
            <div class="step-number">4</div>
            <div class="step-content">
              <h3>Filtrar y Buscar</h3>
              <p>Utiliza los filtros por categoría, proveedor, stock y búsqueda por nombre para encontrar productos rápidamente.</p>
            </div>
          </div>
          <div class="step">
            <div class="step-number">5</div>
            <div class="step-content">
              <h3>Ver Estadísticas y Gráficos</h3>
              <p>Revisa estadísticas detalladas y gráficos para analizar el rendimiento del inventario. Incluye análisis de demanda temporal.</p>
            </div>
          </div>
        </div>
        <button class="slider-arrow slider-arrow-right" id="next-step">›</button>
      </div>
      <div class="slider-indicators">
        <span class="indicator active" data-step="0"></span>
        <span class="indicator" data-step="1"></span>
        <span class="indicator" data-step="2"></span>
        <span class="indicator" data-step="3"></span>
        <span class="indicator" data-step="4"></span>
      </div>
      <button id="start-demo" class="start-demo-btn">Comenzar Demo</button>
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>